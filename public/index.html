<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./styles.css"/>
    <link href="https://github.hubspot.com/odometer/themes/odometer-theme-default.css" rel="stylesheet">    
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>




    <title>Liams Bank</title>
  </head>
  <body>
    <script src="https://github.hubspot.com/odometer/odometer.js"></script>

      <div class="nocontainer rounded topbox">
        <h1 class="whitetext text-muted small">Send Money and watch it CHANGE!!</h1>
        <h1 class="text-muted small ">Pay-Id:</h1>
        <h1 class="whitetext">vaclav@up.me</h1>
      </div>

      <div class="container rounded row-box" align="centre">
        <h1 class="whitetext" >Liam Has</h1>
        <h1 class="orangetext inline dollar">$</h1>
        <h1 class="orangetext odometer inline" id="balance"></h1> 
        <h1 class="whitetext">In His Spending Account</h1>
        <p class="whitetext inline" id="firstText">He Last spent</p>
        <p class="orangetext inline" id="transaction"></p>
        <p class="whitetext inline" id="secondText">at</p>
        <p class="orangetext inline" id="place"></p>
        <p class="whitetext inline" id="thirdText">at</p>
        <p class="orangetext inline" id="time"></p>
        <p class="whitetext" id="fourthText"></p>
        <p class="orangetext" id="message"></p>
      </div>

      <div class="container rounded row-box" align="centre">
        <h1 class="whitetext">Thats</h1>
        <h1 class="orangetext inline">$</h1>
        <h1 class="orangetext inline" id="usd"></h1>
        <h1 class="whitetext inline">USD</h1> 
        <br>
        <h1 class="orangetext inline" >$</h1>
        <h1 class="orangetext inline" id="rubels"></h1>
        <h1 class="whitetext inline">Rubels</h1> 
        <br>
        <h1 class="orangetext inline">$</h1>
        <h1 class="orangetext inline" id="robux"></h1>
        <h1 class="whitetext inline">Robux</h1> 
        <br>
        <h1 class="orangetext inline">$</h1>
        <h1 class="orangetext inline" id="vbucks"></h1>
        <h1 class="whitetext inline">V-Bucks</h1> 
      </div>

    

    <script>

      // Enable pusher logging - don't include this in production
    Pusher.logToConsole = true;

    var pusher = new Pusher('e97d9b08c41bd951e219', {
      cluster: 'ap1'
    });

    var channel = pusher.subscribe('bankauth');
    channel.bind('my-event', function(data) {
      // console.log(JSON.stringify(data));
      getbalance();
    });





     
    



    async function getbalance () {
      //balance
      //calls bankauth function
      const balance = await fetch('/.netlify/functions/bankauth').then(balance => balance.json())
      

    //transactions

  //calls transaction function
  const tbal = await fetch('/.netlify/functions/transaction').then(tbal => tbal.json())

  console.log(tbal)
    //asighns specfic data from json
    let value = '$'+Math.abs(tbal.value)
    let decription = tbal.description
    let timedata = tbal.createdAt
    let messagedata = tbal.message
    let rawText = tbal.rawText
    


    let timedata1 = new Date(timedata).toLocaleString('en-US', { timeZone: 'Australia/Perth' });
    let time = timedata1.substring(10,15)    
          // //12hr time converter
          // let timeString = timedata1.substring(10,18);
          // console.log(timeString)
          //   let timeString12hr = new Date('1970-01-01T' + timeString + 'Z')
          //   .toLocaleTimeString('en-US',
          //     {timeZone:'UTC',hour12:true,hour:'numeric',minute:'numeric'}
          //   );
          //   time = timeString12hr


    const pagebalance = document.getElementById('balance')
    const pagetbal = document.getElementById('transaction')
    const place = document.getElementById('place')
    const pagetime = document.getElementById('time')
    const pagefirstText = document.getElementById('firstText')
    const pagesecondText = document.getElementById('secondText')
    const pagethirdText = document.getElementById('thirdText')
    const pagefourthText = document.getElementById('fourthText')
    const pageMessage = document.getElementById('message')


  //logic to decide if the trnasaction is a pay ment or an outgoing
    if (tbal.message == "" && tbal.message == null){
      pagefirstText.innerText = 'He Last spent'
      pagetbal.innerText = value
      pagesecondText.innerText = 'at'
      place.innerHTML = decription
      pagethirdText.innerText = 'at'
      pagetime.innerText = time
    } else {
      pagefirstText.innerText = 'Just Recieved'
      pagetbal.innerText = value
      pagesecondText.innerText = 'from'
      place.innerHTML = rawText
      pagethirdText.innerText = 'at'
      pagetime.innerText = time
      pagefourthText.innerText = 'They said:'
      pageMessage.innerText = messagedata
    }        

  //sets balance on page
  pagebalance.innerText = balance

  //curencie conversion
    //links code to html (curencies)
    let pageusd = document.getElementById('usd')
    let pagerubel = document.getElementById('rubels')
    let pagerobux = document.getElementById('robux')
    let pagevbux = document.getElementById('vbucks')

    //defines curency value in acordence to aud
    let usd = 0.75
    let rubel = 66.14
    let robux = 57.22
    let vbucks = 83.68

    //converts balance to curency
    let myusd = (usd * balance)
    let myrubel = (rubel * balance)
    let myrobux = (robux * balance);
    let myvbucks = (vbucks * balance)

    //"prints"
    pageusd.textContent = Math.round(myusd)
    pagerubel.textContent = Math.round(myrubel)
    pagerobux.textContent = Math.round(myrobux)
    pagevbux.textContent = Math.round(myvbucks)
}

  // function playmoney () {
  //   var audio = new Audio('/money.mp3');
  //   audio.play();
  // }
      
window.addEventListener('load', async() => {
  getbalance()
  })
      
  
       
     
    </script>
  </body>
</html>
